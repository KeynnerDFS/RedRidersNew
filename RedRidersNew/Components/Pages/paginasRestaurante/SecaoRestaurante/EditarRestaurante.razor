@page "/restaurante/{Id:int}/editar-restaurante/"
@using RedRidersNew.Components.Layout.LayoutRestaurante
@layout MainLayoutRestaurante
@rendermode InteractiveServer
@using RedRidersNew.Models
@inject RestauranteDAO restauranteDAO
@inject NavigationManager Navigation


<PageTitle>Editar Restaurante - @restaurante.Id</PageTitle>

<div class="container py-4">
    <NavBarRestaurante />

    <EditForm Model="@restaurante" OnValidSubmit="Salvar" class="card p-4 mb-4 shadow-sm">

        <DataAnnotationsValidator />
        <ValidationSummary />

        <h4 class="mb-3 fw-semibold border-bottom pb-2">Cadastro de Restaurante</h4>

        <div class="row g-3">

            <!-- Nome do Estabelecimento -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Nome do Estabelecimento</label>
                <input class="form-control" @bind="restaurante.nome" />
            </div>


            <!-- Telefone -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Telefone</label>
                <InputText class="form-control" @bind-Value="restaurante.Telefone" />
            </div>

            <!-- CNPJ -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">CNPJ</label>
                <InputText class="form-control" @bind-Value="restaurante.CNPJ" />
            </div>

            <!-- Tipo de Negócio -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Endereço</label>
                <InputText class="form-control" @bind-Value="restaurante.endereco" />
            </div>

            <!-- Imagem do Estabelecimento -->
            <div class="col-md-12">
                <label class="form-label fw-semibold">URL da Imagem do Estabelecimento</label>
                <InputText class="form-control" @bind-Value="restaurante.imagem" />
            </div>

        </div>

        <div class="mt-4 d-flex justify-content-between">

            <div class="mt-4 text-end">
                <button type="submit" class="btn btn-soft-primary px-4">Salvar</button>
            </div>

        </div>

    </EditForm>
    @if (erro is not null)
    {
        <p style="color:red">@erro</p>
    }


</div>

@code {
    private string erro = string.Empty;

    [Parameter]
    public int Id { get; set; }

    [SupplyParameterFromForm]
    private Restaurante restaurante { get; set; } = new();

    protected override void OnInitialized()
    {
        var _restaurante = restauranteDAO.BuscarPorId(Id);

        if (_restaurante != null)
        {
            restaurante = _restaurante;
        }
        else
        {
            erro = "Produto não encontrado.";
        }
    }

    private void Salvar()
    {
        try
        {
            restauranteDAO.Atualizar(restaurante);

            Navigation.NavigateTo("/restaurante/gerenciar-restaurantes");
        }
        catch (Exception ex)
        {
            erro = $"Erro ao salvar: {ex.Message}";
        }

    }
}
